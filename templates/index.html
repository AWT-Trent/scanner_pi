<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flask Backend with HTML</title>
</head>
<body>
    <h1>Barcodes</h1>
    <form id="addItemForm">
        <input type="text" id="itemInput" placeholder="Enter item">
        <button type="button" onclick="addItem()">Add Item</button>
    </form>
    <select id="itemList" multiple size="5">
        {% for item in items %}
            <option value="{{ loop.index0 }}">{{ item }}</option>
        {% endfor %}
    </select>
    <button type="button" onclick="removeSelectedItems()">Remove Selected</button>

    <h2>Settings</h2>
    <div>
        <label for="itemsPerRunMin">Items per Run (Min):</label>
        <input type="number" id="itemsPerRunMin" value="{{ items_per_run_min }}" min="1">
        <label for="itemsPerRunMax">Items per Run (Max):</label>
        <input type="number" id="itemsPerRunMax" value="{{ items_per_run_max }}" min="1">
        <button type="button" onclick="saveItemsPerRun()">Save</button>
    </div>

    <div>
        <label for="repeatMin">Repeat Times (Min):</label>
        <input type="number" id="repeatMin" value="{{ repeat_times_min }}" min="1">
        <label for="repeatMax">Repeat Times (Max):</label>
        <input type="number" id="repeatMax" value="{{ repeat_times_max }}" min="1">
        <button type="button" onclick="saveRepeatTimes()">Save</button>
    </div>

    <h1>HID Report Generator</h1>
    <form id="hidReportForm">
        <label for="inputString">Input String:</label>
        <input type="text" id="inputString" name="input_string" placeholder="Enter string">
        <button type="button" onclick="generateHIDReport()">Generate HID Report</button>
    </form>

    <script>
        function generateHIDReport() {
            var inputString = document.getElementById("inputString").value;
            fetch('/generate_hid_report', {
                method: 'POST',
                body: new URLSearchParams({
                    'input_string': inputString
                }),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            });
        }

        function addItem() {
            var itemInput = document.getElementById("itemInput");
            var item = itemInput.value.trim();
            if (item !== "") {
                fetch('/add_item', {
                    method: 'POST',
                    body: new URLSearchParams({
                        'item': item
                    }),
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Item added successfully') {
                        itemInput.value = '';
                        refreshItemList();
                    }
                });
            }
        }
    
        function removeSelectedItems() {
            var itemList = document.getElementById("itemList");
            var selectedIndexes = [];
            for (var i = 0; i < itemList.options.length; i++) {
                if (itemList.options[i].selected) {
                    selectedIndexes.push(i); // Push index instead of value
                }
            }
            fetch('/remove_selected_items', {
                method: 'POST',
                body: new URLSearchParams({
                    'indexes': JSON.stringify(selectedIndexes)
                }),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === 'Items removed successfully') {
                    refreshItemList();
                }
            });
        }
    
        function refreshItemList() {
            fetch('/')
            .then(response => response.text())
            .then(data => {
                document.getElementById('itemList').innerHTML = data;
            });
        }
    
        function saveItemsPerRun() {
            var itemsPerRunMin = document.getElementById("itemsPerRunMin").value;
            var itemsPerRunMax = document.getElementById("itemsPerRunMax").value;
            fetch('/save_items_per_run', {
                method: 'POST',
                body: new URLSearchParams({
                    'min': itemsPerRunMin,
                    'max': itemsPerRunMax
                }),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            });
        }
    
        function saveRepeatTimes() {
            var repeatMin = document.getElementById("repeatMin").value;
            var repeatMax = document.getElementById("repeatMax").value;
            fetch('/save_repeat_times', {
                method: 'POST',
                body: new URLSearchParams({
                    'min': repeatMin,
                    'max': repeatMax
                }),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            });
        }
    
        window.onload = function() {
            refreshItemList();
        }
    </script>    
</body>
</html>
